---
import { storyblokEditable } from "@storyblok/astro";
import { useStoryblokApi } from "@storyblok/astro";
import "../styles/global.css";

const storyblokApi = useStoryblokApi();

const { data } = await storyblokApi.get("cdn/stories", {
  version: import.meta.env.DEV ? "draft" : "published",
  content_type: "blogPost",
  sort_by: "first_published_at:desc",
});

const posts = data.stories.map(
  (story: {
    content: { title: any; description: any };
    published_at: string | number | Date;
    full_slug: any;
  }) => {
    return {
      title: story.content.title,
      date: new Date(story.published_at).toLocaleDateString("en-US", {
        dateStyle: "full",
      }),
      description: story.content.description,
      slug: story.full_slug,
    };
  },
);

const { blok } = Astro.props;
---

<ul
  {...storyblokEditable(blok)}
  class="grid gap-[3em] md:grid-cols-2 xl:grid-cols-3"
>
  {
    posts.map((post) => (
      <li class="rounded border-2 border-gray-300 bg-gray-200 p-8 dark:border-gray-700 dark:bg-gray-800">
        <p class="text-sm opacity-50">{post.date}</p>
        <a
          href={post.slug}
          class="opacity-100 hover:text-emerald-500 hover:underline dark:hover:text-emerald-300"
        >
          <h3>{post.title}</h3>
        </a>
        <p class="font-normal opacity-75">{post.description}</p>
      </li>
    ))
  }
</ul>
